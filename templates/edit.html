{% extends "base.html" %}
{% block head %}
<style>
.format{
    width:100%;
    height:90px;
}
.post_hook{
    border-left:5px solid #000;
    padding-left:10px;
}
code{
    color:#333;
    border:1px solid #c0c0c0;
    background-color:#f0f0f0;
}
.bot {
    color:#0b0;
}
.example{
    font-size:12px;
}
</style>
{% end %}
{% block body %}

    <h2>Edit Hook</h2>
    
    <p>
        Created: {{escape(jid.created.strftime("%Y/%m/%d"))}}<br/>
        JID: {{escape(jid.jid)}}<br/>
        HOOK ID: <span class="bot">{{escape(jid.token)}}@partychat-hooks.appspotchat.com</span><br/>
        <em>(invite this hook to your chat room)</em><br/>
    </p>
    

    <fieldset>
        <legend>/alias</legend>
        <p>This sets the alias of the hook in the chatroom to <code>/alias {value}</code></p>
        
        <form method="POST" action="/edit/{{escape(jid.token)}}">
            <label>
                <input type="text" name="alias" size="20" value="{{escape(jid.alias)}}"></label>    
                <button type="submit" name="action.update_alias" value="1">Update</button>
        </form>
    </fieldset>
    
    <hr>
    <h3>Post Hooks</h3>
    <p>These HTTP Endpoints will post data to the JID chat session</p>

    <form method="POST" action="/edit/{{escape(jid.token)}}">
        <button type="submit" name="action.new_post_hook" value="1">New Post Hook</button>
    </form>

    {% for post_hook in jid.posthook_set.fetch(100) %}
        <div class="post_hook">
            HTTP Endpoint: <strong><code>http://partychat-hooks.appspot.com/post/{{escape(post_hook.token)}}</code></strong><br/>
            <form method="POST" action="/edit/{{escape(jid.token)}}">
                <input type="hidden" value="{{escape(post_hook.token)}}" name="token">
                <p class="example">Use Tornado Template Style. Request variables are available as <code>get_argument("field")</code></p>
                <p class="example">If POST body is json content, it will be available as <code>post_json</code></p>
                <textarea name="format" class="format">{{escape(post_hook.format)}}</textarea><br/>
                <button type="submit" name="action.update_post_hook" value="1">Update Format</button>
            </form>
        </div>
    {% end %}
    
{% end %}